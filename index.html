<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Кто ты в летнем лагере? — ШАГАЙ ДОМА</title>
<style>
  :root{ --ink:#3a2f2f; --accent:#b22222; --paper:#fff8e6; --blue:#1f4a7f; }

  html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    background: radial-gradient(1200px 600px at top left, #fff6d8 0%, #fffaf0 35%, #fff 60%) fixed;
    font-family: system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans",Arial,sans-serif;
  }

  .page{
    max-width:860px; margin:24px auto; padding:20px; position:relative;
    background:var(--paper); border:5px double var(--accent);
    border-radius:18px; box-shadow:0 30px 60px rgba(0,0,0,.15);
    overflow: hidden;
  }

  h1{ margin:0 0 8px; text-align:center; color:var(--accent); }

  /* Переключатель «Атмосфера костра» */
  .camp-toggle{display:flex;align-items:center;gap:10px;justify-content:center;margin:8px 0 12px}
  .switch{position:relative;display:inline-block;width:46px;height:26px}
  .switch input{opacity:0;width:0;height:0}
  .slider{position:absolute;cursor:pointer;inset:0;background:#cbd5e1;border-radius:999px;transition:.2s}
  .slider:before{position:absolute;content:"";height:20px;width:20px;left:3px;top:3px;background:white;border-radius:50%;transition:.2s;box-shadow:0 1px 3px rgba(0,0,0,.25)}
  .switch input:checked + .slider{background:#f59e0b}
  .switch input:checked + .slider:before{transform:translateX(20px)}

  /* Ночной режим + свечение */
  .night{ filter: brightness(.95) saturate(1.02); }
  .camp-on{ position:relative; }
  .camp-on::before{
    content:""; position:absolute; inset:-10%; pointer-events:none; z-index:0;
    background: radial-gradient(60% 40% at 50% 100%, rgba(255,160,64,.28) 0%, rgba(255,120,40,.18) 35%, rgba(255,90,20,.08) 55%, rgba(0,0,0,0) 70%);
    animation: glow 2.4s ease-in-out infinite alternate;
  }
  @keyframes glow{ from{filter:brightness(1)} to{filter:brightness(1.06)} }

  /* Искры (канвас поверх, без блокировки кликов) */
  .sparks{ position:absolute; inset:0; pointer-events:none !important; display:none; z-index:1; }

  /* Карточка-вопрос */
  .card{
    background:linear-gradient(#fffef7,#fffaf0);
    border:2px solid #e7d9b6; border-radius:16px; padding:18px 18px 22px;
    box-shadow:0 10px 24px rgba(0,0,0,.08);
    position:relative; z-index:2;
  }

  /* Анимации перелистывания */
  .stage{ position:relative; min-height:260px; }
  .slide{ position:absolute; inset:0; opacity:0; transform:translateX(40px); transition:transform .5s cubic-bezier(.2,.7,.2,1), opacity .5s; }
  .slide.active{ opacity:1; transform:translateX(0); }
  .slide.out-left{ opacity:0; transform:translateX(-40px); }
  .slide.in-right{ opacity:0; transform:translateX(40px); }
  .slide.in-right.active{ opacity:1; transform:translateX(0); }

  .nav{display:flex;align-items:center;gap:12px;margin-top:14px}
  .progress{height:10px;background:#f1e6c8;border-radius:999px;overflow:hidden;flex:1;border:1px solid #e7d9b6}
  .bar{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#ff7a59);transition:width .5s}
  #qnum{font-size:12px;text-transform:uppercase;color:#5c6b7a;margin:6px 0}
  #question{font-size:22px;margin:6px 0 12px}
  #answers{display:grid;gap:10px}
  @media(min-width:700px){#answers{grid-template-columns:1fr 1fr}}
  .answer{
    display:block; width:100%; text-align:left; padding:12px 14px;
    border:2px dashed var(--blue); border-radius:12px; background:#fdf8ea;
    cursor:pointer; transition: background .2s, transform .05s;
  }
  .answer:hover{ background:#fff2c7 }

  /* Результат */
  #result{display:none;text-align:center}
  .badge-wrap{margin:18px auto 8px;width:170px;height:170px;position:relative}
  .cta{display:inline-block;margin-top:16px;padding:12px 24px;background:#b22222;color:#fff;border-radius:24px;text-decoration:none;font-weight:700}
</style>
</head>
<body>
<div class="page" id="page">

  <canvas id="sparks" class="sparks"></canvas>

  <h1>Кто ты в летнем лагере?</h1>

  <div class="camp-toggle">
    <label class="switch">
      <input id="campfireSwitch" type="checkbox" />
      <span class="slider"></span>
    </label>
    <span style="font-size:14px;color:#555">Атмосфера костра</span>
  </div>

  <section id="quiz" class="card" aria-live="polite">
    <div class="nav">
      <div class="progress"><div class="bar" id="bar"></div></div>
    </div>

    <div class="stage" id="stage"><!-- сюда рендерятся слайды --></div>
  </section>

  <section id="result" class="card" style="display:none; position:relative; overflow:hidden">
    <div class="badge-wrap" id="badgeWrap"></div>
    <h2 id="role" style="margin:6px 0 6px; color:var(--accent)"></h2>
    <p id="desc" style="max-width:650px; margin:0 auto 14px; line-height:1.5"></p>

    <!-- Прогрев интенсива -->
    <div id="campPromo" style="margin:12px auto 8px; max-width:680px; text-align:center;">
      <p style="margin:0 0 8px;">Готовы прожить <strong>ваше лето мечты</strong> в духе пионерлагеря?</p>
      <ul style="text-align:left; display:inline-block; margin:0; padding-left:18px; line-height:1.5">
        <li>Зарядки-дискотеки каждый день (движение в удовольствие)</li>
        <li>Лагерные игры, душевные посиделки и поддержка команды</li>
        <li>«Лагерное меню»: вкусно, сытно и без чувства вины</li>
        <li>Тёплая атмосфера и реальные результаты без насилия над собой</li>
      </ul>
      <p style="margin:12px 0 0;">Присоединяйтесь к интенсиву «Летний лагерь» от ШАГАЙ ДОМА — <em>ваше лето начинается здесь!</em></p>
      <p><a class="cta" href="https://walk-walk.ru/summer_camp?utm_source=website&utm_medium=test&utm_campaign=test" target="_blank" rel="noopener">Хочу в отряд!</a></p>
    </div>

    <div style="margin-top:12px">
      <button id="replay" class="answer" style="border-style:solid; text-align:center">Пройти ещё раз</button>
    </div>
  </section>
</div>

<audio id="fireAudio" src="fire.mp3" loop></audio>

<script>
/* ===== РОЛИ ===== */
const ROLES = {
  "Звезда линейки":"Всегда на первых рядах, галстук как с обложки, осанка — пример для всех. Линейка для неё — как красная дорожка.",
  "Хозяйка тихого часа":"Мастер читать под одеялом и обмениваться книжками «из-под полы». Может проспать полдня, но всё равно в курсе всех лагерных событий.",
  "Королева костра":"Гитара, песни, страшилки и разговоры «до отбоя». Вечером вокруг неё собирается весь отряд.",
  "Чемпионка турслёта":"Первая в эстафете, незаменимая в походах. Знает, как разжечь костёр, и может донести котелок даже по самому крутому склону.",
  "Карамельная королева":"Мастер карточных игр на фантики, обменов и карамельных сделок. У неё всегда есть сладости и пара секретов в запасе.",
  "Любительница компота":"Знает расписание всех приёмов пищи, дружит с дежурными по столовой и всегда находит способ взять добавку.",
  "Секретная хулиганка":"С виду пай-девочка, но только до отбоя. Может подложить зубную пасту в тапок или намылить ручку соседнего отряда."
};

/* ===== ВОПРОСЫ (8) с маппингом на роли ===== */
const QUESTIONS = [
  {q:"Что для вас самое важное в лагере?",a:[
    {t:"Выглядеть на все 100",r:"Звезда линейки"},
    {t:"Поспать и почитать",r:"Хозяйка тихого часа"},
    {t:"Вечера у костра",r:"Королева костра"},
    {t:"Побеждать в эстафетах",r:"Чемпионка турслёта"},
    {t:"Обмены сладостями",r:"Карамельная королева"},
    {t:"Компот и вкусности",r:"Любительница компота"},
    {t:"Весёлые розыгрыши",r:"Секретная хулиганка"}
  ]},
  {q:"Что вы ждёте в посылке из дома?",a:[
    {t:"Новую форму/заколки",r:"Звезда линейки"},
    {t:"Книгу или журнал",r:"Хозяйка тихого часа"},
    {t:"Фонарик и батарейки",r:"Королева костра"},
    {t:"Кроссовки для эстафет",r:"Чемпионка турслёта"},
    {t:"Пакет карамелек",r:"Карамельная королева"},
    {t:"Домашнее варенье",r:"Любительница компота"},
    {t:"Шуточную открытку",r:"Секретная хулиганка"}
  ]},
  {q:"Ваш любимый момент лагерного дня:",a:[
    {t:"Торжественная линейка",r:"Звезда линейки"},
    {t:"Тихий час",r:"Хозяйка тихого часа"},
    {t:"Посиделки у костра",r:"Королева костра"},
    {t:"Спортивные соревнования",r:"Чемпионка турслёта"},
    {t:"Обмен фантиками",r:"Карамельная королева"},
    {t:"Обед/полдник",r:"Любительница компота"},
    {t:"Время после отбоя",r:"Секретная хулиганка"}
  ]},
  {q:"Свободный вечер — что выберете?",a:[
    {t:"Подготовить форму на завтра",r:"Звезда линейки"},
    {t:"Досмотреть книжку/подремать",r:"Хозяйка тихого часа"},
    {t:"Придумать песню/историю",r:"Королева костра"},
    {t:"Потренироваться к стартам",r:"Чемпионка турслёта"},
    {t:"Разменять фантики на карамельки",r:"Карамельная королева"},
    {t:"Заглянуть на кухню за добавкой",r:"Любительница компота"},
    {t:"Организовать безобидный розыгрыш",r:"Секретная хулиганка"}
  ]},
  {q:"Самое вкусное в столовой — это…",a:[
    {t:"Манная каша/котлета с пюре",r:"Звезда линейки"},
    {t:"Булочка к чаю",r:"Хозяйка тихого часа"},
    {t:"Горячий чай (даже если из столовой)",r:"Королева костра"},
    {t:"Макароны с тушёнкой",r:"Чемпионка турслёта"},
    {t:"Шоколадка из обмена",r:"Карамельная королева"},
    {t:"Компот или кисель",r:"Любительница компота"},
    {t:"Всё подряд, лишь бы весело",r:"Секретная хулиганка"}
  ]},
  {q:"Дождливый день в лагере — ваш выбор:",a:[
    {t:"Навести лоск: причёска/галстук",r:"Звезда линейки"},
    {t:"Плед и книга под окно",r:"Хозяйка тихого часа"},
    {t:"Петь под гитару в корпусе",r:"Королева костра"},
    {t:"Тренировка в спортзале",r:"Чемпионка турслёта"},
    {t:"Обмен сладостями/настолки",r:"Карамельная королева"},
    {t:"Чай с печеньем и компот",r:"Любительница компота"},
    {t:"Организовать квест-розыгрыш",r:"Секретная хулиганка"}
  ]},
  {q:"Что вы чаще всего теряли в лагере?",a:[
    {t:"Значок/галстук",r:"Звезда линейки"},
    {t:"Закладку для книги",r:"Хозяйка тихого часа"},
    {t:"Фонарик",r:"Королева костра"},
    {t:"Спортивную повязку",r:"Чемпионка турслёта"},
    {t:"Шоколадку (её «выиграли»)",r:"Карамельная королева"},
    {t:"Стакан для компота",r:"Любительница компота"},
    {t:"Ключ от тумбочки (иногда)",r:"Секретная хулиганка"}
  ]},
  {q:"Объявили «Смотр песни и строя». Ваша реакция?",a:[
    {t:"Выпрямить спину и вперёд!",r:"Звезда линейки"},
    {t:"Поспать полчасика до репетиции",r:"Хозяйка тихого часа"},
    {t:"Придумать речёвку у костра",r:"Королева костра"},
    {t:"Разминка и чёткий шаг",r:"Чемпионка турслёта"},
    {t:"Договориться о карамельках за крик команды",r:"Карамельная королева"},
    {t:"После смотра — в столовую!",r:"Любительница компота"},
    {t:"Подложить свисток вожатой (шутка)",r:"Секретная хулиганка"}
  ]}
];

/* ===== DOM ===== */
const page = document.getElementById('page');
const campSwitchEl = document.getElementById('campfireSwitch');
const sparksCanvas = document.getElementById('sparks');
const spCtx = sparksCanvas.getContext('2d');
const bar = document.getElementById('bar');
const stage = document.getElementById('stage');

const resultSection = document.getElementById('result');
const roleEl = document.getElementById('role');
const descEl = document.getElementById('desc');
const badgeWrap = document.getElementById('badgeWrap');
const replayBtn = document.getElementById('replay');
const fireAudio = document.getElementById('fireAudio');

/* ===== STATE ===== */
let idx = 0;
let scores = Object.create(null);

/* ===== RENDER ===== */
function renderQuestion() {
  const total = QUESTIONS.length;
  const q = QUESTIONS[idx];

  bar.style.width = (idx/total*100) + '%';

  // старый слайд → out-left
  const current = stage.querySelector('.slide.active');
  if (current) {
    current.classList.remove('active');
    current.classList.add('out-left');
    setTimeout(()=> current.remove(), 500);
  }

  // новый слайд
  const slide = document.createElement('div');
  slide.className = 'slide in-right';
  slide.innerHTML = `
    <div id="qnum" style="font-size:12px;text-transform:uppercase;color:#5c6b7a;margin:6px 0">Вопрос ${idx+1} из ${total}</div>
    <div id="question" style="font-size:22px;margin:6px 0 12px">${q.q}</div>
    <div id="answers" style="display:grid;gap:10px;${window.innerWidth>=700?'grid-template-columns:1fr 1fr':''}">
      ${q.a.map(a=>`<button class="answer" data-role="${a.r}">${a.t}</button>`).join('')}
    </div>
  `;
  stage.appendChild(slide);

  // активируем плавный вход
  requestAnimationFrame(()=>{
    slide.classList.remove('in-right');
    slide.classList.add('active');
  });

  // клики ответов
  slide.querySelector('#answers').addEventListener('click', (e)=>{
    const btn = e.target.closest('.answer');
    if(!btn) return;
    const role = btn.dataset.role;
    scores[role] = (scores[role]||0)+1;

    idx++;
    if (idx < total) renderQuestion();
    else showResult();
  });
}

function showResult(){
  // прогресс в 100%
  bar.style.width = '100%';

  // скрыть сцену, показать результат
  document.getElementById('quiz').style.display = 'none';
  resultSection.style.display = 'block';

  const winner = Object.keys(scores).reduce((a,b)=> (scores[a]||0) > (scores[b]||0) ? a : b);
  roleEl.textContent = winner;
  descEl.textContent = ROLES[winner];
  drawBadge(winner);
}

function drawBadge(role){
  badgeWrap.innerHTML='';
  const svgNS='http://www.w3.org/2000/svg';
  const svg=document.createElementNS(svgNS,'svg'); svg.setAttribute('viewBox','0 0 200 200'); svg.style.width='100%'; svg.style.height='100%';
  const defs=document.createElementNS(svgNS,'defs');
  const grad=document.createElementNS(svgNS,'radialGradient'); grad.id='g1';
  grad.innerHTML='<stop offset="0%" stop-color="#fff6d6"/><stop offset="60%" stop-color="#f1c16d"/><stop offset="100%" stop-color="#c58a21"/>';
  defs.appendChild(grad); svg.appendChild(defs);
  const circle=document.createElementNS(svgNS,'circle'); circle.setAttribute('cx','100'); circle.setAttribute('cy','100'); circle.setAttribute('r','78'); circle.setAttribute('fill','url(#g1)'); circle.setAttribute('stroke','#8a5a12'); circle.setAttribute('stroke-width','6'); svg.appendChild(circle);
  const ribbon=document.createElementNS(svgNS,'path'); ribbon.setAttribute('d','M60 170 L100 130 L140 170 L120 170 L100 150 L80 170 Z'); ribbon.setAttribute('fill','var(--accent)'); ribbon.setAttribute('opacity','.9'); svg.appendChild(ribbon);
  const icon=document.createElementNS(svgNS,'text'); icon.setAttribute('x','100'); icon.setAttribute('y','105'); icon.setAttribute('text-anchor','middle'); icon.setAttribute('dominant-baseline','central'); icon.setAttribute('font-size','48'); icon.setAttribute('font-weight','700'); icon.setAttribute('fill','#612e0a'); icon.textContent=iconFor(role); svg.appendChild(icon);
  const t=document.createElementNS(svgNS,'text'); t.setAttribute('x','100'); t.setAttribute('y','188'); t.setAttribute('text-anchor','middle'); t.setAttribute('font-size','12'); t.setAttribute('fill','#5a4635'); t.textContent=role; svg.appendChild(t);
  badgeWrap.appendChild(svg);
}
function iconFor(role){
  switch(role){
    case 'Звезда линейки': return '★';
    case 'Хозяйка тихого часа': return '☕';
    case 'Королева костра': return '🔥';
    case 'Чемпионка турслёта': return '🏅';
    case 'Карамельная королева': return '🍬';
    case 'Любительница компота': return '🥤';
    case 'Секретная хулиганка': return '😼';
    default: return '⭐';
  }
}

/* ===== АТМОСФЕРА КОСТРА (искры + звук) ===== */
let sparksRunning=false, SP=[], spRAF=null, lastTime=0, windT=0;

function resizeSparks(){
  const r = page.getBoundingClientRect();
  sparksCanvas.width = r.width; sparksCanvas.height = r.height;
}
addEventListener('resize', resizeSparks);

function makeSpark(){
  const w = sparksCanvas.width, h = sparksCanvas.height;
  const sx = w * 0.45 + Math.random()*w*0.10;
  const sy = h + Math.random()*30;
  const v0 = 60 + Math.random()*140;
  const vx = (Math.random()*2 - 1) * 20;
  const life = 0.8 + Math.random()*1.6;
  const size = 1 + Math.random()*2.3;
  const phase = Math.random()*Math.PI*2;
  return { x:sx, y:sy, vx, vy:-v0, size, life, maxLife:life, phase, hue: 30 + Math.random()*12 };
}
function startSparks(){
  if(sparksRunning) return; sparksRunning=true; resizeSparks();
  SP = Array.from({length:100}, makeSpark); lastTime = performance.now();
  loopSparks();
}
function stopSparks(){ sparksRunning=false; if(spRAF) cancelAnimationFrame(spRAF); }
function loopSparks(){
  if(!sparksRunning) return;
  const now = performance.now(); let dt = (now - lastTime)/1000; if(dt>0.05) dt=0.05; lastTime=now; windT+=dt;
  const w = sparksCanvas.width, h = sparksCanvas.height;
  spCtx.clearRect(0,0,w,h); spCtx.globalCompositeOperation='lighter';
  for(let i=0;i<SP.length;i++){
    const p = SP[i];
    const wind = Math.sin(windT*0.9 + p.phase)*20; const jitter = Math.sin(windT*6 + p.phase)*4;
    p.vx += (wind*0.5) * dt; p.x += (p.vx + jitter) * dt; p.y += p.vy * dt;
    p.life -= dt; const k = Math.max(0, p.life/p.maxLife); const size = p.size * (0.6 + 0.4*k); const alpha = Math.min(1, 0.15 + k*0.9);
    const trail = spCtx.createRadialGradient(p.x,p.y+size*2,0,p.x,p.y+size*2,size*6);
    trail.addColorStop(0, `hsla(${p.hue+5},90%,55%,${alpha*0.35})`); trail.addColorStop(1,'hsla(25,90%,50%,0)');
    spCtx.fillStyle = trail; spCtx.beginPath(); spCtx.arc(p.x,p.y+size*2,size*4,0,Math.PI*2); spCtx.fill();
    const grad = spCtx.createRadialGradient(p.x,p.y,0,p.x,p.y,size*3);
    grad.addColorStop(0, `hsla(50,100%,85%,${alpha})`); grad.addColorStop(0.35, `hsla(${p.hue},95%,60%,${alpha*0.9})`); grad.addColorStop(1, `hsla(${p.hue+10},90%,40%,0)`);
    spCtx.fillStyle = grad; spCtx.beginPath(); spCtx.arc(p.x,p.y,size*2.2,0,Math.PI*2); spCtx.fill();
    if (p.life<=0 || p.y<-20 || p.x<-20 || p.x>w+20){ if(Math.random()<0.08){ const big=makeSpark(); big.size*=1.6; big.vy*=1.15; SP[i]=big; } else SP[i]=makeSpark(); }
  }
  spCtx.globalCompositeOperation='source-over';
  spRAF = requestAnimationFrame(loopSparks);
}

/* звук fire.mp3 c плавным входом/выходом */
let fadeTimer=null;
function smoothVolumeTo(target, ms, cb){
  if(!fireAudio) return;
  if(fadeTimer) clearInterval(fadeTimer);
  const start=fireAudio.volume; const t0=performance.now();
  fadeTimer=setInterval(()=>{
    const k=Math.min(1,(performance.now()-t0)/ms);
    fireAudio.volume = start + (target-start)*k;
    if(k>=1){ clearInterval(fadeTimer); fadeTimer=null; if(cb) cb(); }
  }, 16);
}

campSwitchEl.addEventListener('change', (e)=>{
  if(e.target.checked){
    page.classList.add('camp-on','night');
    sparksCanvas.style.display='block';
    startSparks();
    fireAudio.volume = 0.0;
    fireAudio.play().catch(()=>{});
    smoothVolumeTo(0.5, 300);
  } else {
    page.classList.remove('camp-on','night');
    sparksCanvas.style.display='none';
    stopSparks();
    smoothVolumeTo(0.0, 200, ()=>{ try{ fireAudio.pause(); fireAudio.currentTime=0; }catch(_){} });
  }
});

/* ===== GO ===== */
function startQuiz(){ idx=0; scores=Object.create(null); renderQuestion(); }
startQuiz();

/* Пройти ещё раз */
replayBtn.addEventListener('click', ()=>location.reload());
</script>
</body>
</html>
